# 音声入力記録機能 詳細設計書：チームコンパス

## 1. 設計コンセプト

**「その場で、声で、生徒の成長を記録する」**

教師にとって、生徒一人ひとりの日々の様子や対話の内容をキーボードで入力するのは、大きな負担です。そこで、**音声入力**により、授業中や休み時間の気づきを、その場で即座に記録できる機能を提供します。記録されたデータはAIが自動で整理し、三者面談や進路相談などの重要な場面で、教師が説得力のある対話を行うための強力な武器となります。

---

## 2. 技術スタック

### 2.1. 音声認識エンジン

**OpenAI Whisper API**を採用します。

**選定理由**
- **高精度**: 日本語の音声認識精度が非常に高く、教育現場の専門用語にも対応
- **ノイズ耐性**: 教室や廊下など、雑音が多い環境でも正確に文字起こし可能
- **Azure統合**: Azure OpenAI Serviceを通じて利用でき、既存のAzure環境とシームレスに統合

### 2.2. データフロー

```
[教師の音声入力]
  ↓
[Whisper API（音声→テキスト変換）]
  ↓
[Azure SQL Database（生データ保存）]
  ↓
[GPT-4による自動整理・要約]
  ↓
[教師向けダッシュボードに表示]
```

---

## 3. 機能仕様

### 3.1. 音声入力画面

#### 画面構成

1. **生徒選択**
   - ドロップダウンまたは検索で、記録対象の生徒を選択
   - 複数生徒の同時選択も可能（例：グループ活動の記録）

2. **録音ボタン**
   - 大きく目立つ「🎤 録音開始」ボタン
   - タップすると録音開始、もう一度タップで録音停止
   - 録音中は波形アニメーションで視覚的にフィードバック

3. **カテゴリ選択（オプション）**
   - 記録の種類を選択：「授業中の様子」「休み時間の対話」「課外活動」「その他」
   - AIの自動分類を補助するための情報

4. **保存ボタン**
   - 録音停止後、「保存」ボタンで記録を確定
   - 保存前に、文字起こし結果のプレビューと手動修正が可能

#### UX上の工夫

- **モバイルファースト**: スマホやタブレットでの利用を前提とした設計
- **ワンタップで記録**: 生徒選択→録音→保存の3ステップで完結
- **オフライン対応（将来機能）**: 音声をローカルに一時保存し、後でまとめてアップロード

### 3.2. 文字起こし結果の表示

#### 自動文字起こし

- Whisper APIが音声をテキストに変換
- 変換結果は即座に画面に表示され、教師が確認・修正可能

#### 手動修正機能

- 固有名詞や専門用語の誤認識を、その場で修正
- 修正内容は学習データとして蓄積し、将来的な精度向上に活用（オプション）

---

## 4. データ構造

### 4.1. 記録データのスキーマ

| フィールド名 | 型 | 説明 |
|---|---|---|
| `record_id` | UUID | 記録の一意識別子 |
| `teacher_id` | UUID | 記録した教師のID |
| `student_ids` | JSON配列 | 対象生徒のID（複数可） |
| `audio_url` | String | 音声ファイルのAzure Blob Storage URL |
| `transcript` | Text | 文字起こし結果（生データ） |
| `edited_transcript` | Text | 教師が手動修正した後のテキスト |
| `category` | Enum | 記録のカテゴリ（授業中、休み時間など） |
| `created_at` | DateTime | 記録日時 |
| `ai_summary` | Text | AIによる要約（後述） |
| `ai_tags` | JSON配列 | AIが自動付与したタグ（例：「リーダーシップ」「協調性」） |

### 4.2. セキュリティとプライバシー

- **音声ファイル**: Azure Blob Storageに暗号化して保存
- **アクセス制御**: 記録した教師と管理者のみがアクセス可能
- **保存期間**: 卒業後一定期間（例：3年）で自動削除

---

## 5. AI による自動整理・要約

### 5.1. 要約生成

記録された膨大なテキストデータを、GPT-4が自動で要約します。

**入力（プロンプト例）**

```
以下は、教師が生徒について記録した観察メモです。
この内容を、3-5行で簡潔に要約してください。

【記録内容】
{edited_transcript}
```

**出力例**

> 田中さんは、グループワークでリーダー役を自ら引き受け、メンバーに的確な指示を出していた。ただし、他のメンバーの意見を聞く前に自分の考えを押し通す場面も見られた。傾聴力を高めることで、より効果的なリーダーシップを発揮できる可能性がある。

### 5.2. タグの自動付与

記録内容から、関連する非認知能力のタグを自動で抽出します。

**入力（プロンプト例）**

```
以下の記録内容から、関連する非認知能力を以下のリストから選んでください（複数可）。
- リーダーシップ
- 協調性
- 創造性
- 実行力
- 傾聴・伝達力
- 柔軟性

【記録内容】
{edited_transcript}
```

**出力例**

```json
["リーダーシップ", "傾聴・伝達力"]
```

### 5.3. 長期的なトレンド分析（将来機能）

- 複数の記録を横断的に分析し、「最近、協調性に関する記録が増えている」などのトレンドを検出
- 教師に「この生徒は〇〇の能力が伸びている可能性があります」と通知

---

## 6. 教師向けダッシュボードでの表示

### 6.1. 個別生徒の記録タイムライン

- 生徒の詳細画面に、時系列で記録を表示
- 各記録には、日付、カテゴリ、要約、タグが表示される
- クリックすると、全文と音声ファイルを確認可能

### 6.2. 能力別フィルター

- 「リーダーシップに関する記録のみ表示」など、タグでフィルタリング可能
- 特定の能力の成長を追跡しやすくする

### 6.3. 検索機能

- キーワードで記録を全文検索
- 例：「文化祭」で検索すると、文化祭に関連する全ての記録が表示される

---

## 7. 利用シーンの想定

### 7.1. 日常の観察記録

**シーン**: 授業中、田中さんがグループワークでリーダーシップを発揮している様子を観察

**教師の行動**
1. 授業後、スマホでアプリを開く
2. 田中さんを選択し、録音ボタンをタップ
3. 「田中さんは、今日のグループワークでリーダー役を自ら引き受け、メンバーに的確な指示を出していました。ただ、他のメンバーの意見を聞く前に自分の考えを押し通す場面も見られました。」と音声で記録
4. 保存ボタンをタップ

**システムの処理**
- Whisperが音声をテキスト化
- GPT-4が要約とタグを自動生成
- 田中さんの記録タイムラインに追加

### 7.2. 三者面談での活用

**シーン**: 田中さんの保護者との三者面談

**教師の行動**
1. 事前に、田中さんの記録タイムラインを確認
2. AIが生成した要約と、診断結果の能力スコアを組み合わせて、面談資料を準備
3. 面談では、「田中さんは、リーダーシップが非常に高く、診断結果でも85点と出ています。実際、先月の文化祭では実行委員長として活躍していました。ただ、傾聴力にはまだ伸びしろがあり、今後はメンバーの意見をもっと聞く経験を積むと良いと思います。」と、データと具体的なエピソードを組み合わせて説明

**効果**
- 保護者は、客観的なデータと具体的なエピソードに基づいた説明に納得
- 生徒も、自分の成長が可視化されていることを実感

### 7.3. 進路相談での活用

**シーン**: 田中さんとの進路相談

**教師の行動**
1. 田中さんの能力スコアと記録タイムラインを確認
2. 「君はリーダーシップと実行力が高いから、経営学部やプロジェクトマネジメントの分野に向いているかもしれないね。でも、今の強みだけに固執せず、色々な経験を積んでみることも大事だよ。」とアドバイス

**効果**
- 生徒は、自分の強みを客観的に理解し、進路選択の参考にできる
- 教師は、固定化のリスクにも配慮したバランスの取れたアドバイスができる

---

## 8. 実装上の考慮事項

### 8.1. コスト

- **Whisper API**: 音声1分あたり約$0.006（約0.9円）
- **GPT-4 API**: 要約生成1回あたり約$0.01-0.02（約1.5-3円）
- 教師1人が1日10件の記録（各1分）を行った場合、月間コストは約500-1000円

### 8.2. レスポンス時間

- Whisper APIの文字起こし：音声1分あたり約5-10秒
- GPT-4の要約生成：約3-5秒
- 合計：録音停止から結果表示まで約10-15秒

### 8.3. スケーラビリティ

- Azure OpenAI Serviceは、大量のリクエストにも対応可能
- 学校全体で数百人の教師が同時に利用しても、問題なく動作

---

## 9. MVPでの実装範囲

### 9.1. MVP（フェーズ1）に含む機能

- 音声入力と文字起こし（Whisper API）
- 手動修正機能
- 記録の保存とタイムライン表示
- AIによる要約生成（GPT-4）
- タグの自動付与

### 9.2. 将来機能（フェーズ2以降）

- オフライン対応
- 長期的なトレンド分析
- 音声認識の精度向上（カスタムモデルの学習）
- 保護者への記録共有機能

---

## 10. 結論

音声入力記録機能は、教師の負担を大幅に軽減しつつ、生徒一人ひとりの成長を具体的に記録・可視化する、本システムの**差別化要因**となります。診断データと日常の記録を組み合わせることで、教師は三者面談や進路相談において、**根拠のある、説得力のある対話**を実現できます。これこそが、教育現場が真に求めているツールです。
