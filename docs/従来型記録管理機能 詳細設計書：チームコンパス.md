# 従来型記録管理機能 詳細設計書：チームコンパス

## 1. 設計コンセプト

**「AIに頼らず、教師が使いやすい記録管理を実現する」**

個人情報保護の観点から、AIによる記録の自動要約・タグ付けは行いません。代わりに、教師が直感的に操作できる、従来型の検索・フィルタリング・タグ付け機能を提供します。

シンプルながらも強力な機能により、教師は膨大な記録を効率的に管理し、必要な情報を素早く取り出すことができます。

---

## 2. 記録管理機能の全体像

### 2.1. 機能一覧

| 機能名 | 目的 | 実装方法 |
|---|---|---|
| **音声文字起こし** | 音声を正確にテキスト化 | Whisper API（個人情報保護措置あり） |
| **記録の編集** | 文字起こし後のテキストを自由に編集 | リッチテキストエディタ |
| **手動タグ付け** | 記録に能力タグを手動で付与 | プリセットタグのワンクリック選択 |
| **キーワード検索** | 記録のテキスト全文を検索 | Azure SQL Databaseの全文検索機能 |
| **フィルタリング** | タグ・日付・生徒で記録を絞り込み | SQLクエリによる高速フィルタリング |
| **記録タイムライン** | 生徒ごとの記録を時系列で表示 | 日付順ソート表示 |
| **面談資料生成** | 診断データと記録をテンプレートに統合 | サーバーサイドでのPDF生成 |

---

## 3. 各機能の詳細設計

### 3.1. 音声文字起こし

#### 機能概要

教師がスマホアプリで録音した音声を、Whisper APIで高精度にテキスト化します。個人情報保護のため、音声データは文字起こし後に即座に削除されます。

#### 操作フロー

1.  **録音開始**: 教師は、生徒選択画面で生徒を選び、「🎤 録音開始」ボタンをタップ。
2.  **音声録音**: 教師が話した内容がリアルタイムで録音される。画面には経過時間が表示される。
3.  **録音停止**: 「⏹ 停止」ボタンをタップすると、録音が終了。
4.  **文字起こし処理**: 音声データがWhisper APIに送信され、テキストに変換される。処理中は「文字起こし中...」と表示。
5.  **編集画面へ遷移**: 文字起こしが完了すると、自動で編集画面に遷移。文字起こしされたテキストが表示される。

#### 技術仕様

-   **使用API**: Azure OpenAI Service - Whisper API
-   **音声形式**: WebM（Opus codec）、最大10分
-   **処理時間**: 約5-10秒（音声1分あたり）
-   **精度**: 日本語の認識精度は約95%（静かな環境）

---

### 3.2. 記録の編集

#### 機能概要

文字起こしされたテキストを、教師が自由に編集できます。誤変換の修正、不要な部分の削除、要点の強調などが可能です。

#### 画面構成

-   **テキストエリア**: 文字起こしされたテキストが表示される。複数行入力可能。
-   **ツールバー**: 太字、斜体、下線、リストなどの書式設定ボタン。
-   **文字数カウンター**: 現在の文字数を表示（例：「523 / 5000文字」）。
-   **保存ボタン**: 編集内容を保存。
-   **キャンセルボタン**: 編集を破棄して、前の画面に戻る。

#### 技術仕様

-   **エディタ**: Quill.js（軽量なリッチテキストエディタ）
-   **最大文字数**: 5,000文字
-   **自動保存**: 30秒ごとに下書きとして自動保存

---

### 3.3. 手動タグ付け

#### 機能概要

記録に、関連する非認知能力のタグを手動で付与します。これにより、後で「リーダーシップに関する記録のみ表示」といったフィルタリングが可能になります。

#### 操作フロー

1.  **タグ選択画面**: 記録編集画面の下部に、6つの能力タグが表示される。
2.  **タグの選択**: 教師は、関連するタグをタップして選択。選択されたタグは色が変わる（複数選択可）。
3.  **保存**: 「保存」ボタンをタップすると、記録とタグが一緒に保存される。

#### タグ一覧

-   リーダーシップ
-   協調性
-   創造性
-   実行力
-   傾聴・伝達力
-   柔軟性

#### 技術仕様

-   **UI**: チップ形式のボタン（Material Design風）
-   **データ保存**: 記録IDとタグIDの中間テーブルで多対多の関係を管理

---

### 3.4. キーワード検索

#### 機能概要

記録のテキスト全文を対象に、キーワードで検索できます。複数のキーワードを組み合わせた検索も可能です。

#### 操作フロー

1.  **検索バーに入力**: 教師向けダッシュボードの上部にある検索バーに、キーワードを入力。
2.  **検索実行**: Enterキーを押すか、虫眼鏡アイコンをクリックすると、検索が実行される。
3.  **結果表示**: 該当する記録が、ハイライト付きで一覧表示される。

#### 検索仕様

-   **全文検索**: Azure SQL Databaseの全文検索機能を使用。
-   **部分一致**: 「文化祭」と入力すると、「文化祭実行委員」なども検索される。
-   **AND検索**: 「文化祭 リーダーシップ」と入力すると、両方のキーワードを含む記録のみが表示される。
-   **ハイライト**: 検索結果の記録テキスト内で、キーワードが黄色でハイライトされる。

#### 技術仕様

-   **検索エンジン**: Azure SQL Database Full-Text Search
-   **インデックス**: 記録テキストカラムに全文検索インデックスを作成
-   **レスポンス時間**: 1万件の記録でも、1秒以内に検索結果を返す

---

### 3.5. フィルタリング

#### 機能概要

タグ、日付、生徒で記録を絞り込み、必要な情報を素早く取り出せます。

#### フィルタリング項目

| 項目 | 選択肢 | 動作 |
|---|---|---|
| **タグ** | 6つの能力タグから選択（複数可） | 選択されたタグが付与された記録のみ表示 |
| **日付範囲** | 「過去1週間」「過去1ヶ月」「過去3ヶ月」「カスタム」 | 指定された期間内の記録のみ表示 |
| **生徒** | クラスの生徒一覧から選択 | 選択された生徒の記録のみ表示 |

#### 操作フロー

1.  **フィルタパネルを開く**: ダッシュボードの「🔽 フィルタ」ボタンをクリック。
2.  **条件を選択**: タグ、日付、生徒の条件を選択。
3.  **適用**: 「適用」ボタンをクリックすると、条件に合致する記録のみが表示される。
4.  **クリア**: 「クリア」ボタンをクリックすると、フィルタが解除され、全ての記録が表示される。

#### 技術仕様

-   **実装**: SQLのWHERE句による絞り込み
-   **パフォーマンス**: タグ、日付、生徒IDにインデックスを作成し、高速化

---

### 3.6. 記録タイムライン

#### 機能概要

生徒ごとの記録を、時系列で一覧表示します。生徒の成長のプロセスを、時間軸で把握できます。

#### 画面構成

-   **生徒情報ヘッダー**: 生徒の名前、写真、最新の能力スコアを表示。
-   **タイムライン**: 記録が新しい順に縦に並ぶ。各記録には、日付、タグ、テキストの冒頭（100文字）が表示される。
-   **詳細表示**: 記録をクリックすると、全文が表示される。

#### 技術仕様

-   **ソート**: 記録日時の降順（新しい順）
-   **ページネーション**: 1ページあたり20件表示。「もっと見る」ボタンで追加読み込み。

---

### 3.7. 面談資料の生成

#### 機能概要

三者面談や進路相談の前に、診断データと記録を統合したPDFレポートを生成します。AIは使わず、テンプレートに当てはめる方式で生成します。

#### レポート構成

1.  **表紙**
    -   生徒名、学年、クラス
    -   レポート生成日

2.  **能力プロフィール**
    -   6つの能力のレーダーチャート
    -   前回診断との比較グラフ

3.  **成長ハイライト**
    -   最も成長した能力TOP3
    -   各能力について、スコアの変化を数値で表示

4.  **記録サマリー**
    -   過去3ヶ月間の記録数
    -   各能力タグごとの記録数
    -   主要な記録のリスト（最新5件）

5.  **教師からのコメント**
    -   教師が自由に記入できるコメント欄（事前に入力）

#### 操作フロー

1.  **生成ボタンをクリック**: 生徒の詳細画面で、「📄 面談資料を生成」ボタンをクリック。
2.  **コメント入力**: ポップアップが表示され、教師がコメントを入力。
3.  **生成実行**: 「生成」ボタンをクリックすると、サーバーでPDFが生成される。
4.  **ダウンロード**: 生成完了後、PDFが自動でダウンロードされる。

#### 技術仕様

-   **PDF生成ライブラリ**: WeasyPrint（Python）
-   **テンプレート**: HTMLとCSSで作成したテンプレートを使用
-   **生成時間**: 約5-10秒

---

## 4. データベース設計

### 4.1. テーブル構成

#### ① 記録テーブル（records）

| カラム名 | データ型 | 説明 |
|---|---|---|
| id | INT (PK) | 記録ID |
| student_id | INT (FK) | 生徒ID |
| teacher_id | INT (FK) | 教師ID |
| text | TEXT | 記録のテキスト（最大5,000文字） |
| created_at | DATETIME | 記録日時 |
| updated_at | DATETIME | 更新日時 |

#### ② タグテーブル（tags）

| カラム名 | データ型 | 説明 |
|---|---|---|
| id | INT (PK) | タグID |
| name | VARCHAR(50) | タグ名（例：「リーダーシップ」） |

#### ③ 記録タグ中間テーブル（record_tags）

| カラム名 | データ型 | 説明 |
|---|---|---|
| record_id | INT (FK) | 記録ID |
| tag_id | INT (FK) | タグID |

### 4.2. インデックス設計

-   **全文検索インデックス**: records.text
-   **検索高速化インデックス**: records.student_id, records.created_at, record_tags.tag_id

---

## 5. UI/UXの工夫

### 5.1. モバイルファースト

教師は、授業の合間や移動中にスマホで記録を確認することが多いため、モバイルでの操作性を最優先に設計します。

### 5.2. ワンタップ操作

タグの選択、フィルタの適用など、頻繁に行う操作は、ワンタップで完了できるようにします。

### 5.3. 視覚的なフィードバック

検索結果のハイライト、タグの色分けなど、視覚的なフィードバックを豊富に提供し、直感的に操作できるようにします。

---

## 6. 結論

「チームコンパス」の従来型記録管理機能は、AIに頼らずとも、教師が膨大な記録を効率的に管理できる、シンプルかつ強力な仕組みです。

個人情報保護を最優先としながらも、音声入力による負担軽減と、検索・フィルタリングによる情報アクセスの高速化を実現します。これこそが、教育現場が真に求める、**信頼と実用性の両立**です。
